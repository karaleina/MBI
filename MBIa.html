
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>MBI - analiza składowych głównych </title>
        <!--<link rel="stylesheet" type="text/css" href="http://www.templatki.net/podglad/business-template-blog/css/style.css" />-->
        <link rel="stylesheet" type="text/css" href="style.css" />
    </head>

    <body>
        <div id="wrapper">
            <div id="header">
                <div id="logo">
                    <h2>MBI - analiza składowych głównych (PCA) </h2>
                </div>
            </div>
        </div>

        <div id="container">
            <div id="sidebar">
                <div id="content_box">
                   	<h2>Wybierz wymiar danych wejściowych</h2>
                    <form>
                      <p>Liczba <i>m</i> cech</p>
                      <select id="wymiar_m">
                          <option value="2">2</option>
                      		<option value="3">3</option>
                      		<option value="4">4</option>
                      		<option value="5">5</option>
                    	</select>
                    </form>
                    <form>
                      <p>Liczba <i>n</i> pomiarów</p>
                    	<select id="wymiar_n">
                      		<option value="2">2</option>
                      		<option value="3">3</option>
                      		<option value="4">4</option>
                      		<option value="5">5</option>
                      		<option value="6">6</option>
                      		<option value="7">7</option>
                    	</select>
                    </form>

                    <form>
                        <input type="button" id="createDataTable"  value="Stwórz arkusz"><br/><br/>

                        <div id="input_table_print">
                            <table id="input_data_table" class='hidden user_input' table border="1" cellspacing="5">
                                <tr>
                                   <th></th>	<th>M1</th>	<th>M2</th>
                                </tr>
                                <tr id="N1">
                                   <th>N1</th>	<td class="M1" contenteditable='true'></td><td class="M2" contenteditable='true'></td>
                                </tr>
                                <tr id="N2">
                                   <th>N2</th>	<td class="M2" contenteditable='true'></td>	<td class="M2" contenteditable='true'></td>
                                </tr>
                            </table>
                        </div>


                        <input type="button" id="deleteDataTable"  class="user_input hidden" value="Usuń arkusz"><br/><br/>

                        <div class="form-group">
                            <div class="user_input hidden" >
                            <h2>Opcje:</h2>
                                <label for="krokowo" class="col-sm-6 control-label">krok po kroku</label>
                                <div class="col-sm-1 control-label">
                                    <input type="checkbox" class="form-control" id="krokowo"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <input type="button"  id="getData" class="user_input hidden" value="START"><br/><br/>
                            <!-- <input type="button"  id="setExampleData" value="Wczytaj przykładowe dane"><br/><br/>
                            <input type="button"  id="start" value="Start" disabled='true'> -->
                        </div>
                    </form>
                </div>

            </div>

            <div id="solid" class="border">
                <h2>Działanie algorytmu</h2>
                    <div id="steps">
                    </div>
            </div>
        </div>

        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" src="MBIjavascript.js" ></script>
        <script src="pca-with-dependencies.js"></script>

        <script>

        $(document).ready(function(){

            var nieznormalizowane_dane = null;

            function getM(){
                var wymiar_m = $("#wymiar_m").val();
                return wymiar_m;
            }
            function getN(){
                var wymiar_n = $("#wymiar_n").val();
                return wymiar_n;
            }

            function countMeans(array, m, n){

                var srednie_atrybutow = [];
                for (var i = 0; i< m; i++){
                    // po rzędach
                    var suma_cechy = 0;
                    for (var j = 0; j< n; j++) {
                        suma_cechy += parseFloat(array[j][i]);
                    }
                    srednie_atrybutow[i] = suma_cechy/n;
                }
                return srednie_atrybutow;
            }

            function countStd(array, srednie_atrybutow, m, n ){
                  //TODO porawic bo cos nie dziala
                  var odchylenie_cechy = [];
                  //idziemy po cechach
                  for(var i = 0; i < m; i++){
                      var suma_kwadratow = 0;
                      //idziemy po rzędach
                      for (var j = 0; j< n; j++) {
                          var currentValue = parseFloat(array[j][i]);
                          suma_kwadratow += (currentValue - srednie_atrybutow[i])*(currentValue - srednie_atrybutow[i]);
                      }
                      odchylenie_cechy[i] = Math.sqrt(suma_kwadratow / n);
                  }
                  return odchylenie_cechy;
            }

            function translateDataIntoMatrix(m, n) {

                var nieznormalizowane_dane = new Matrix(parseFloat(n),  parseFloat(m));
                var dataMatrix = [];
                var currentValue = 0;
                var currentRow = 0;
                var dataCurrentRow = [];

                for( var i = 1; i <= n; i++){
                    dataCurrentRow=[];
                    currentRow = $('#input_data_table').find(".N" + i);
                    for (var j = 1; j<= m; j++){
                        currentValue = currentRow.find(".M" + j).text();
                        dataCurrentRow.push(currentValue);

                    }
                    dataMatrix.push("[" + dataCurrentRow + "]");
                    nieznormalizowane_dane[i - 1] = dataCurrentRow;
                }
                return nieznormalizowane_dane;
            }

            function normalization(srednie_atrybutow, odchylenie_atrybutow, nieznormalizowane_dane){
                var m = getM();
                var n = getN();

                var nieznormalizowane_dane = translateDataIntoMatrix(m, n);
                var nieznormalizowane_2d_array = nieznormalizowane_dane.to2DArray();

                for(var i = 1 ; i <= m; i++) {
                    var column_vector = nieznormalizowane_dane.getColumnVector(i-1);
                    column_vector = column_vector.map( function(value) {
                        return (value - srednie_atrybutow[i-1])/odchylenie_atrybutow[i-1];
                    } );
                    nieznormalizowane_dane.setColumn(i-1, column_vector);
                }

                var znormalizowane_dane = nieznormalizowane_dane;
                return znormalizowane_dane;

            }

          function convertMatrixIntoHtmlTable(matrix_2d_array, m,  n){
                //var matrix_2d_array = matrix.to2DArray();

                var table = $("<table class=results></table>");

                var firstrow = $("<tr><th></th></tr>");
                for (var k = 1; k <= m; k++){

                    firstrow.append("<th>M" + k  +  "</th>");
                }

                table.append(firstrow);

                for(var i = 0; i < n; i++ ){
                    var current_array_row = matrix_2d_array[i];
                    var current_table_row = $("<tr><th>N" + parseInt(i+1) + "</th></tr>");

                    for(var j = 0; j < m; j++){
                        var current_data = current_array_row[j];
                        current_table_row.append("<td>" + current_data + "</td>");
                    }

                    table.append(current_table_row);
                    //table.append("<tr>" + current_table_row + "</tr>");
                }

                //table = $("<table>" + table + "</table>");
                return table;

          }

          function convertArrayIntoTable(array, m){

                var table = $("<table class=results></table>");

                var firstrow = $("<tr></tr>");
                var lastrow = $("<tr></tr>");
                for (var k = 1; k <= m; k++){
                    firstrow.append("<th>M" + k  +  "</th>");
                    lastrow.append("<td>" + array [k - 1] + "</td>");
                }
                table.append(firstrow);
                table.append(lastrow);

                return table;

          }


            $("#getData").on("click", function(){
                var m = getM();
                var n = getN();

                var nieznormalizowane_dane = translateDataIntoMatrix(m, n);
                var nieznormalizowane_2d_array = nieznormalizowane_dane.to2DArray();

                var srednie_atrybutow = countMeans(nieznormalizowane_2d_array, m, n);
                console.log(srednie_atrybutow);

                var odchylenie_atrybutow = countStd(nieznormalizowane_2d_array, srednie_atrybutow, m, n );
                console.log(odchylenie_atrybutow);

                var znormalizowane_dane = normalization(srednie_atrybutow, odchylenie_atrybutow, nieznormalizowane_dane);

                //czyść
                $("#steps").empty();



                $("#steps").append("<h2>Krok 1:</h2>");

                //średnia
                $("#steps").append("<h3>Średnia z cech:</h3>");
                var srednia_cech_table = convertArrayIntoTable(srednie_atrybutow, m);
                $("#steps").append(srednia_cech_table);

                //odchylenie
                $("#steps").append("<h3>Odchylenie z cech:</h3>");
                var odchylenie_cech_table = convertArrayIntoTable(odchylenie_atrybutow, m);
                $("#steps").append(odchylenie_cech_table);

                $("#steps").append("<h3>Wzór, pod który podstawiamy:</h3>")
                $("#steps").append("<img src=krok1.jpg></img>");

                //macierz znormalizowana`
                $("#steps").append("<h3>Otrzymana znormalizowana macierz danych:</h3>");
                var table = convertMatrixIntoHtmlTable(znormalizowane_dane.to2DArray(), m, n);
                $("#steps").append(table);

            });




            /*
            const dataset = mldatasetiris.getNumbers();

            // dataset is a two-dimensional array where rows represent the samples and columns the features
            const pca = new PCA(dataset);
            console.log(pca.getExplainedVariance());

                  const newPoints = [[4.9, 3.2, 1.2, 0.4], [5.4, 3.3, 1.4, 0.9]];
            console.log(pca.predict(newPoints)); // project new points into the PCA space

            // Operacje na macierzach
                  var m1 = Matrix.ones(5, 5);
                  var m2 = Matrix.ones(5, 5);

            var multiplied = m1.mmul(m2);
                  var determinant = multiplied.det();

                  console.log(multiplied);
                  console.log(determinant);

            // Możesz odwoływać się też do ml-stat
            console.log(mlstat.array.sum([1, 2, 3]));

            // I do ml-array-utils
            console.log(mlarrayutils.applyDotProduct([1, 2, 3], [1, 2, 3]));

            var kosmos = 132;
            var blabla = new Matrix (([[2,3],[3,4]]), 2);
            console.log("Czy to macierz?: " + Matrix.isMatrix(blabla) );
            console.log("Czy to macierz?: " + Matrix.isMatrix(kosmos) );
            //var blabla_array = Matrix.to2DArray(blabla);

            //console.log(blabla_array[0].length);*/
        });

      	</script>
    </body>
</html>
